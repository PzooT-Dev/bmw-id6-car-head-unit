#:kivy 1.11.0
#:import BMWID6Theme ui.themes.BMWID6Theme

# Apply global theme
<Label>:
    color: BMWID6Theme.TEXT_PRIMARY
    font_size: BMWID6Theme.FONT_SIZE_MEDIUM

<Button>:
    background_color: [0, 0, 0, 0]  # Transparent background
    color: BMWID6Theme.TEXT_PRIMARY
    font_size: BMWID6Theme.FONT_SIZE_MEDIUM

# Main screen manager
<ScreenManager>:
    canvas.before:
        Color:
            rgba: BMWID6Theme.BACKGROUND
        Rectangle:
            pos: self.pos
            size: self.size

# Dashboard Screen
<DashboardScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        
        # Status bar at top
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            
            Label:
                text: root.time
                size_hint_x: None
                width: dp(100)
                font_size: BMWID6Theme.FONT_SIZE_LARGE
            
            Widget:
                # Spacer
            
            Label:
                text: 'Outside: {}°C'.format(int(root.outside_temp))
                size_hint_x: None
                width: dp(150)
        
        # Main content
        BoxLayout:
            orientation: 'horizontal'
            
            # Left panel - Speed gauge
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.5
                
                Label:
                    text: 'SPEED'
                    size_hint_y: None
                    height: dp(30)
                    font_size: BMWID6Theme.FONT_SIZE_MEDIUM
                
                Widget:
                    # This would contain a custom gauge widget in full implementation
                    canvas:
                        Color:
                            rgba: BMWID6Theme.PRIMARY
                        Line:
                            circle: self.center_x, self.center_y, min(self.width, self.height) / 3, 0, 360
                            width: dp(5)
                
                Label:
                    text: '{} km/h'.format(int(root.speed))
                    font_size: BMWID6Theme.FONT_SIZE_XLARGE
            
            # Right panel - RPM gauge
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.5
                
                Label:
                    text: 'RPM'
                    size_hint_y: None
                    height: dp(30)
                    font_size: BMWID6Theme.FONT_SIZE_MEDIUM
                
                Widget:
                    # This would contain a custom gauge widget in full implementation
                    canvas:
                        Color:
                            rgba: BMWID6Theme.ACCENT_RED
                        Line:
                            circle: self.center_x, self.center_y, min(self.width, self.height) / 3, 0, 360
                            width: dp(5)
                
                Label:
                    text: '{}'.format(int(root.rpm))
                    font_size: BMWID6Theme.FONT_SIZE_XLARGE
        
        # Bottom panel - Additional vehicle data
        BoxLayout:
            size_hint_y: 0.3
            padding: [dp(10), dp(10)]
            
            # Fuel level
            BoxLayout:
                orientation: 'vertical'
                
                Label:
                    text: 'FUEL'
                    font_size: BMWID6Theme.FONT_SIZE_SMALL
                
                ProgressBar:
                    value: root.fuel_level
                    max: 100
                
                Label:
                    text: '{}%'.format(int(root.fuel_level))
            
            # Coolant temperature
            BoxLayout:
                orientation: 'vertical'
                
                Label:
                    text: 'COOLANT'
                    font_size: BMWID6Theme.FONT_SIZE_SMALL
                
                Label:
                    text: '{}°C'.format(int(root.coolant_temp))
                    font_size: BMWID6Theme.FONT_SIZE_LARGE
        
        # Navigation bar at bottom
        BoxLayout:
            size_hint_y: None
            height: dp(80)
            
            Button:
                text: 'Dashboard'
                on_press: root.manager.current = 'dashboard'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'dashboard' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Media'
                on_press: root.manager.current = 'media'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'media' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Navigation'
                on_press: root.manager.current = 'navigation'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'navigation' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Settings'
                on_press: root.manager.current = 'settings'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'settings' else [0.2, 0.2, 0.2, 1]

# Media Player Screen
<MediaPlayerScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        
        # Title bar
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            
            Label:
                text: 'BMW Media'
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'left'
                text_size: self.size
                valign: 'middle'
            
            Label:
                text: 'DAB' if root.is_dab_mode else 'FM'
                size_hint_x: None
                width: dp(100)
                font_size: BMWID6Theme.FONT_SIZE_LARGE
        
        # Station info
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: 0.3
            
            Label:
                text: root.current_station
                font_size: BMWID6Theme.FONT_SIZE_XLARGE
                halign: 'center'
            
            Label:
                text: root.current_frequency
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'center'
        
        # RDS text area
        BoxLayout:
            size_hint_y: 0.2
            
            Label:
                text: root.rds_text
                font_size: BMWID6Theme.FONT_SIZE_MEDIUM
                halign: 'center'
        
        # Signal strength
        BoxLayout:
            size_hint_y: 0.1
            padding: [dp(50), 0]
            
            Label:
                text: 'Signal'
                size_hint_x: None
                width: dp(80)
            
            ProgressBar:
                value: root.signal_strength
                max: 100
            
            Label:
                text: '{}%'.format(int(root.signal_strength))
                size_hint_x: None
                width: dp(80)
        
        # Media controls
        BoxLayout:
            size_hint_y: 0.3
            padding: [dp(20), dp(10)]
            
            Button:
                text: 'Prev'
                on_press: root.seek_prev_station()
                background_normal: ''
                background_color: [0.3, 0.3, 0.3, 1]
                font_size: BMWID6Theme.FONT_SIZE_LARGE
            
            Button:
                text: 'Play/Pause' if not root.is_playing else 'Pause'
                on_press: root.toggle_play_pause()
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY
                font_size: BMWID6Theme.FONT_SIZE_LARGE
            
            Button:
                text: 'Next'
                on_press: root.seek_next_station()
                background_normal: ''
                background_color: [0.3, 0.3, 0.3, 1]
                font_size: BMWID6Theme.FONT_SIZE_LARGE
        
        # Volume control
        BoxLayout:
            size_hint_y: 0.1
            padding: [dp(20), 0]
            
            Label:
                text: 'Volume'
                size_hint_x: None
                width: dp(80)
            
            Slider:
                min: 0
                max: 100
                value: root.current_volume
                on_value: root.adjust_volume(self.value)
            
            Label:
                text: '{}%'.format(int(root.current_volume))
                size_hint_x: None
                width: dp(80)
        
        # Mode toggle
        Button:
            text: 'Switch to FM' if root.is_dab_mode else 'Switch to DAB'
            size_hint_y: 0.15
            on_press: root.toggle_radio_mode()
            background_normal: ''
            background_color: [0.3, 0.3, 0.3, 1]
        
        # Navigation bar at bottom
        BoxLayout:
            size_hint_y: None
            height: dp(80)
            
            Button:
                text: 'Dashboard'
                on_press: root.manager.current = 'dashboard'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'dashboard' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Media'
                on_press: root.manager.current = 'media'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'media' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Navigation'
                on_press: root.manager.current = 'navigation'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'navigation' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Settings'
                on_press: root.manager.current = 'settings'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'settings' else [0.2, 0.2, 0.2, 1]

# Navigation Screen
<NavigationScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        
        # Title bar
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            
            Label:
                text: 'BMW Navigation'
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'left'
                text_size: self.size
                valign: 'middle'
        
        # Map area (placeholder)
        BoxLayout:
            orientation: 'vertical'
            padding: dp(20)
            
            Label:
                text: root.status_message
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'center'
            
            Label:
                text: 'Navigation display would be shown here'
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'center'
            
            # This would be replaced with actual map widget in full implementation
            Widget:
                canvas:
                    Color:
                        rgba: [0.2, 0.2, 0.2, 1]
                    Rectangle:
                        pos: self.pos
                        size: self.size
        
        # Navigation bar at bottom
        BoxLayout:
            size_hint_y: None
            height: dp(80)
            
            Button:
                text: 'Dashboard'
                on_press: root.manager.current = 'dashboard'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'dashboard' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Media'
                on_press: root.manager.current = 'media'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'media' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Navigation'
                on_press: root.manager.current = 'navigation'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'navigation' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Settings'
                on_press: root.manager.current = 'settings'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'settings' else [0.2, 0.2, 0.2, 1]

# Settings Screen
<SettingsScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        
        # Title bar
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            
            Label:
                text: 'Settings'
                font_size: BMWID6Theme.FONT_SIZE_LARGE
                halign: 'left'
                text_size: self.size
                valign: 'middle'
        
        # Settings content
        BoxLayout:
            orientation: 'vertical'
            padding: [dp(20), dp(10)]
            spacing: dp(20)
            
            # Brightness control
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                
                Label:
                    text: 'Brightness'
                    size_hint_x: 0.3
                
                Slider:
                    min: 0
                    max: 100
                    value: root.brightness
                    on_value: root.adjust_brightness(self.value)
                
                Label:
                    text: '{}%'.format(int(root.brightness))
                    size_hint_x: 0.2
            
            # Audio balance control
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                
                Label:
                    text: 'Audio Balance'
                    size_hint_x: 0.3
                
                Slider:
                    min: 0
                    max: 100
                    value: root.audio_balance
                    on_value: root.adjust_audio_balance(self.value)
                
                Label:
                    text: 'L <{}> R'.format('-' * int(root.audio_balance / 10) + '|' + '-' * int((100 - root.audio_balance) / 10))
                    size_hint_x: 0.2
            
            # Night mode toggle
            BoxLayout:
                size_hint_y: None
                height: dp(50)
                
                Label:
                    text: 'Night Mode'
                    size_hint_x: 0.3
                
                Button:
                    text: 'ON' if root.night_mode else 'OFF'
                    on_press: root.toggle_night_mode()
                    background_normal: ''
                    background_color: BMWID6Theme.PRIMARY if root.night_mode else [0.3, 0.3, 0.3, 1]
            
            # System status
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: dp(150)
                padding: [0, dp(20)]
                
                Label:
                    text: 'System Status'
                    font_size: BMWID6Theme.FONT_SIZE_LARGE
                    size_hint_y: None
                    height: dp(30)
                
                GridLayout:
                    cols: 2
                    spacing: dp(10)
                    
                    Label:
                        text: 'CAN Bus:'
                        halign: 'right'
                        text_size: self.size
                        valign: 'middle'
                    
                    Label:
                        text: root.can_status
                        color: [0, 1, 0, 1] if root.can_status == 'Connected' else [1, 0, 0, 1]
                        halign: 'left'
                        text_size: self.size
                        valign: 'middle'
                    
                    Label:
                        text: 'Radio:'
                        halign: 'right'
                        text_size: self.size
                        valign: 'middle'
                    
                    Label:
                        text: root.radio_status
                        color: [0, 1, 0, 1] if root.radio_status == 'Active' else [1, 0, 0, 1]
                        halign: 'left'
                        text_size: self.size
                        valign: 'middle'
                    
                    Label:
                        text: 'System Version:'
                        halign: 'right'
                        text_size: self.size
                        valign: 'middle'
                    
                    Label:
                        text: root.system_version
                        halign: 'left'
                        text_size: self.size
                        valign: 'middle'
            
            # Restart services button
            Button:
                text: 'Restart Services'
                size_hint_y: None
                height: dp(60)
                on_press: root.restart_services()
                background_normal: ''
                background_color: [0.8, 0.2, 0.2, 1]
            
            Widget:
                # Spacer
        
        # Navigation bar at bottom
        BoxLayout:
            size_hint_y: None
            height: dp(80)
            
            Button:
                text: 'Dashboard'
                on_press: root.manager.current = 'dashboard'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'dashboard' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Media'
                on_press: root.manager.current = 'media'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'media' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Navigation'
                on_press: root.manager.current = 'navigation'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'navigation' else [0.2, 0.2, 0.2, 1]
            
            Button:
                text: 'Settings'
                on_press: root.manager.current = 'settings'
                background_normal: ''
                background_color: BMWID6Theme.PRIMARY if root.manager.current == 'settings' else [0.2, 0.2, 0.2, 1]
